= ソースコードを読む

ここではGoプログラマに広く使われているツール類のソースコードを読むことで、実戦でどのようにAPIが利用されているかを見ていきます。

== go doc

パッケージのAPIのドキュメントを閲覧する機能を提供するサブコマンドです。
`go doc go/ast Node` のようにパッケージやシンボルを指定すると、そのドキュメントを表示します。

パッケージ名は完全なパスでなくてもよく、その場合はGOPATH以下からマッチするものを探してきます。

ソースは `src/cmd/doc/` 以下にあります。

// TODO: godoc との関係

=== 引数の解決（`parseArgs`）

最初に、引数で指定された要件にしたがってドキュメントの元となるソースコードを取得します。

`go doc` への引数の与え方はさまざまで、パッケージを指定する方法には次の3パターンがあります：

a. カレントディレクトリのソースコードを対象にする（例：`go doc`）。
b. 完全なパスで指定されたパッケージを対象にする（例：`go doc encoding/json`）。
c. 指定されたパスの一部からパッケージを探しだす（例：`go doc json`）。

これに加えて、パッケージ内のシンボルおよびそのメソッドも指定されることがあります。

カレントディレクトリを対象にする場合およびパッケージが指定されている場合（aおよびb）は、`go/build` のAPI `build.Import` を使って簡単にソースコードの所在を示す `build.Package` が得られます。

そうでない場合（c）、パスの一部が一致するパッケージを発見する必要があります。ここでも `go/build` のAPIを利用し、`build.Default.GOROOT` と `build.Default.GOPATH` 以下のディレクトリを探索します。`go doc` コマンドが実行された時点でこの探索のためのgoroutineが起動していて、すばやく結果を返せるようになっています。

=== ドキュメントの表示

== go fmt
== stringer
== guru
== goimports
== gddo
